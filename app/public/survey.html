<!doctype html>
<html lang="en">
  <head>
    <title>Troll Survey</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Favicon -->
    <link rel="icon" href="https://png.icons8.com/color/160/orc.png" type="image/png" sizes="32x32">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">

    
    
  </head>
  <body>
    <div class="container">  

        <div class="row">
            <h2 class="d-flex align-items-center mt-4"><img class="mr-1" src="https://png.icons8.com/color/160/orc.png" alt="Survey Icon" height="40px">
                Troll Survey Form
            </h2>
        </div>
      <hr>

    <!-- user details -->
    <div class="row">
        <h3>
            About You
        </h3>
    </div>

    <div class="row">
        <p class="mb-0 mt-1 p-1">
            Bestowed Name of The Cursed (Required):
        </p>
        <input id="nameInput" class="form-control" type="text" placeholder="Enter your name here">
    </div>

    <div class="row">
        <p class="mb-0 mt-1 p-1">
            Link to Photo Image (Required)
        </p>
        <input id="imageInput" class="form-control" type="text" placeholder="Provide a link to a picture of that lovely ugly mug here">
    </div>

    <hr>
    
    
    <!-- Questions -->
    <!-- Question 1-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 1:</h4>
        <p class="mb-0 mt-1 p-1">
            You prefer to operate under bridges.
        </p>
        
        <select id="q1" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 2-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 2:</h4>
        <p class="mb-0 mt-1 p-1">
            You often ask three riddle questions before anyone shall pass.
        </p>
        
        <select id="q2" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 3-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 3:</h4>
        <p class="mb-0 mt-1 p-1">
            You prefer a fresh kill to a meal that is handed to you.
        </p>
        
        <select id="q3" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 4-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 4:</h4>
        <p class="mb-0 mt-1 p-1">
            It is the size of your horns that matters most.
        </p>
        
        <select id="q4" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 5-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 5:</h4>
        <p class="mb-0 mt-1 p-1">
            The idea of associating with the humans disgusts you.
        </p>
        
        <select id="q5" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 6-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 6:</h4>
        <p class="mb-0 mt-1 p-1">
            You agree with the statement that in order to suceed you must divide to conquer.
        </p>
        
        <select id="q6" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 7-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 7:</h4>
        <p class="mb-0 mt-1 p-1">
            You are offended by how troll kind is portrayed in modern media and video games.
        </p>
        
        <select id="q7" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 8-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 8:</h4>
        <p class="mb-0 mt-1 p-1">
            Reflect on the truth in this statement. Trolls are some of the most affectionate beings around.
        </p>
        
        <select id="q8" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 9-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 9:</h4>
        <p class="mb-0 mt-1 p-1">
            Primal instincts are the only instincts.
        </p>
        
        <select id="q9" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Question 10-->
    <div class="row d-flex flex-column mt-4 mb-4">

        <h4>Inquiry 10:</h4>
        <p class="mb-0 mt-1 p-1">
            Your aspirations are to follow a great troll leader.
        </p>
        
        <select id="q10" class="custom-select" style="width: 200px">
            <option selected>Pick on a scale of 1 - 5</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
            </select>
    </div>

    <!-- Submit Button -->
    <input id="submit" class="btn btn-success pt-3 pb-3 pl-5 pr-5 font-weight-bold" type="submit" value="Get Trollin' (Submit)">
    
    
    <hr>
    <!-- Modal to display match -->
    <!-- Button trigger modal -->
    <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
            Launch demo modal
        </button> -->
      
      <!-- Modal -->
      <div class="modal fade" id="matchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalTitle">Your Match!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <!-- Match Results Area -->
            <div class="modal-body">
                
                <div id="modalName"></div>
                
                <div id="modalImg"></div>
                
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              
            </div>
          </div>
        </div>
      </div>


    <!-- footer -->
    <footer>
        <a href="/api/trolls">API Trolls List</a> | <a href="https://github.com/circuitsyn/TrollConnection">GitHub Repo</a> | <a href="/home">Home</a>
    
    </footer>
    </div>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
  </body>
</html>

<script type="text/javascript">


var leadingMatchDiffNum = 0;
var currentNum = 0;
var status = 0;
var count = 0;
var resultTroll;

//function to grab data and find match
function dataCall(newTroll) {
    // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
    $.ajax({ url: "/api/trolls", method: "GET" })
      .then(function(trollData) {

        // Here we then log the tableData to console, where it will show up as an object.
        console.log('troll data: ', trollData);
        console.log("------------------------------------");
        
        findMatch(trollData, newTroll);
        
        
      });
  }

//function to figure out match
function findMatch(trollData, newTroll) {
    
    for(i = 0; i < trollData.length; i++){       
        //reinitializing zero value to reset current num and counts
        var leadingMatchDiffNum = 0;
        var currentNum = 0;
        var status = 0;
        var count = 0;

        for(j = 0; j < newTroll.scores.length; j++){
            //parseInt is used to prevent string concatination as well as avoiding +=
            count = Math.abs(parseInt(trollData[i].scores[j]) - parseInt(newTroll.scores[j]));
            status = parseInt(status) + count;
        }
        
        currentNum = status; 
        console.log('currentnum: ', currentNum);
        if((currentNum < leadingMatchDiffNum) || (leadingMatchDiffNum == 0)){
                leadingMatchDiffNum = currentNum;
                resultTroll = trollData[i];
                console.log('leading num: ', leadingMatchDiffNum);
                console.log('i: ',i);
                console.log(trollData[i]);
                console.log('result troll: ', resultTroll);
                
        }
    }
    postResult(resultTroll);
}

//function to build modals before triggering the user result
function postResult(resultTroll) {
    //append name
    var title = $('<h3>');
    $(title).text(resultTroll.name);
    $('#modalName').empty();
    $('#modalName').append(title);

    //append img
    var img = $('<img>');
    $(img).attr('src', resultTroll.photo);
    $(img).attr('alt', 'Match Image Result');
    $('#modalImg').empty();
    $('#modalImg').append(img);
};




$("#submit").on("click", function(event) {
    event.preventDefault();

    

    // Here we grab the form elements
    var newTroll = {
      name: $("#nameInput").val().trim(),
      photo: $("#imageInput").val().trim(),
      scores: [
          $("#q1").val(),
          $("#q2").val(),
          $("#q3").val(),
          $("#q4").val(),
          $("#q5").val(),
          $("#q6").val(),
          $("#q7").val(),
          $("#q8").val(),
          $("#q9").val(),
          $("#q10").val()
    ]
    };
    
    console.log('new troll: ', newTroll);

    //call to kick off data retrieval and innerfunctions to analyza and launch data
    dataCall(newTroll);

    $.post("/api/trolls", newTroll, function(data) {  

  });
        //Show results
        $("#matchModal").modal("toggle");
});
</script>